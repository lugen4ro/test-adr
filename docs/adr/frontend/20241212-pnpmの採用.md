# pnpmの採用

## ステータス

Approved

## 背景

パッケージマネージャーを検討する必要がある。

選択肢としては npm、yarn、pnpm とした。

主な要件は以下の通り。

- インストールの高速化が可能なこと
- ディスク使用量を抑えられること
- Monorepo管理との親和性が高いこと

## 結論

pnpmを採用する。 npmやyarnと比較して、以下の理由からpnpmを採用することとした。

ツール比較の詳細は以下の通り。

**pnpm**

- コンテンツアドレス可能なストアによりディスク使用量を削減
- 依存関係の厳密な管理
- インストールが高速

**npm/yarn**

- node_modulesにパッケージをフラットに配置
- 依存関係の重複により、ディスク使用量が増加

## 論点

## 適用した結果

## **Pros**

- ハードリンクを活用することで、ディスク使用量を大幅に削減できる
- 依存関係の厳密な管理により、パッケージ間の依存関係の問題を防げる
- npmと互換性のあるコマンドのため、学習コストが低い

## **Cons**

- 高速なインストールを担保するため、CI環境でのキャッシュ設定が必要
- 一部のツールでpnpmのシンボリックリンク構造に対応していない可能性がある
- 社内での利用実績が他のパッケージマネージャーと比べて少ない

## 撤退条件

以下の状況が発生した場合、yarnもしくはnpmへの移行を検討する。

- CI実行時間が既存の2倍以上に増加し、対策を講じても改善できない
- 重要な開発ツールでpnpmとの互換性の問題が解消できない
- メジャーバージョンアップデートで重大な後方互換性の問題が発生した場合
